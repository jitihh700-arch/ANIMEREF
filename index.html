<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIMEREF - Votre plateforme d'anime</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #f47521;
            --secondary-color: #23252b;
            --background-color: #0f1015;
            --card-color: #1a1c23;
            --text-color: #ffffff;
            --text-secondary: #aaaaaa;
            --success-color: #4CAF50;
            --danger-color: #e53935;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--primary-color);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 32px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav ul li {
            position: relative;
        }

        nav ul li a {
            color: var(--text-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav ul li a:hover, nav ul li a.active {
            background-color: rgba(244, 117, 33, 0.2);
            color: var(--primary-color);
        }

        /* Main container */
        .main-container {
            display: flex;
            flex: 1;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background-color: var(--secondary-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .sidebar h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-item {
            padding: 12px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.3s;
            color: var(--text-color);
            text-decoration: none;
        }

        .sidebar-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-item.active {
            background-color: rgba(244, 117, 33, 0.2);
            color: var(--primary-color);
        }

        /* Content area */
        .content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        /* Section management */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Video player */
        .video-player-container {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .video-title {
            padding: 20px;
            font-size: 22px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .video-player {
            width: 100%;
            background-color: #000;
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .video-player video {
            width: 100%;
            max-height: 70vh;
            outline: none;
        }

        .no-video-selected {
            font-size: 20px;
            color: var(--text-secondary);
            text-align: center;
            padding: 50px;
        }

        .video-actions {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #e06a1a;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #2d313d;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c62828;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        .like-section {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .like-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 22px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .like-btn.liked {
            color: var(--danger-color);
        }

        .views {
            color: var(--text-secondary);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Import section */
        .import-container {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .import-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-control {
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* Library */
        .library-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .video-card {
            background-color: var(--card-color);
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .video-thumbnail {
            width: 100%;
            height: 140px;
            object-fit: cover;
            background-color: #000;
        }

        .video-card-info {
            padding: 15px;
        }

        .video-card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .video-card-details {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .delete-video-btn {
            background-color: transparent;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .delete-video-btn:hover {
            background-color: rgba(229, 57, 53, 0.1);
        }

        /* Comments */
        .comments-container {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            margin-top: 25px;
        }

        .comments-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .comment-form {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .comment-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text-color);
            font-size: 16px;
        }

        .comment-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .comment {
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 600;
            color: var(--primary-color);
        }

        .comment-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .comment-text {
            margin-bottom: 10px;
        }

        .comment-actions {
            display: flex;
            gap: 15px;
        }

        .comment-action {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s;
        }

        .comment-action:hover {
            color: var(--primary-color);
        }

        /* History */
        .history-container {
            background-color: var(--card-color);
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .history-item {
            display: flex;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            align-items: center;
            gap: 15px;
        }

        .history-thumbnail {
            width: 120px;
            height: 70px;
            object-fit: cover;
            border-radius: 6px;
        }

        .history-info {
            flex: 1;
        }

        .history-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .history-date {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Admin controls */
        .admin-controls {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .message {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .message.success {
            background-color: rgba(76, 175, 80, 0.2);
            color: #a5d6a7;
        }

        .message.error {
            background-color: rgba(229, 57, 53, 0.2);
            color: #ef9a9a;
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            margin-top: 30px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 15px;
            }
            
            .sidebar-section {
                margin-bottom: 0;
            }
            
            .video-player {
                min-height: 300px;
            }
            
            .library-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            nav ul {
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .library-container {
                grid-template-columns: 1fr;
            }
            
            .video-actions {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-play-circle"></i>
            <span>ANIMEREF</span>
        </div>
        <nav>
            <ul>
                <li><a href="#" id="nav-home" class="active"><i class="fas fa-home"></i> Accueil</a></li>
                <li><a href="#" id="nav-history"><i class="fas fa-history"></i> Historique</a></li>
                <li><a href="#" id="nav-library"><i class="fas fa-film"></i> Bibliothèque</a></li>
                <li><a href="#" id="nav-import"><i class="fas fa-upload"></i> Importer</a></li>
            </ul>
        </nav>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-fire"></i> Tendance</h3>
                <a href="#" class="sidebar-item active" data-section="home">
                    <i class="fas fa-play"></i> Vidéo en cours
                </a>
            </div>
            
            <div class="sidebar-section">
                <h3><i class="fas fa-user"></i> Mon Compte</h3>
                <div class="sidebar-item" id="admin-toggle">
                    <i class="fas fa-crown"></i> Mode Admin
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3><i class="fas fa-cog"></i> Paramètres</h3>
                <div class="sidebar-item" id="clear-history">
                    <i class="fas fa-trash"></i> Vider l'historique
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Accueil Section -->
            <div id="home-section" class="section active">
                <div class="video-player-container">
                    <div class="video-title" id="current-video-title">
                        Aucune vidéo sélectionnée
                    </div>
                    <div class="video-player">
                        <div class="no-video-selected" id="no-video-message">
                            <i class="fas fa-film" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <p>Sélectionnez une vidéo dans la bibliothèque pour commencer la lecture</p>
                        </div>
                        <video id="video-player" controls class="hidden">
                            Votre navigateur ne supporte pas la lecture de vidéos.
                        </video>
                    </div>
                    <div class="video-actions">
                        <div class="action-buttons">
                            <button class="btn btn-primary" id="play-btn">
                                <i class="fas fa-play"></i> Lire
                            </button>
                            <button class="btn btn-secondary" id="pause-btn">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                            <button class="btn btn-danger hidden" id="delete-current-btn">
                                <i class="fas fa-trash"></i> Supprimer cette vidéo
                            </button>
                        </div>
                        <div class="like-section">
                            <button class="like-btn" id="like-btn">
                                <i class="far fa-heart"></i>
                            </button>
                            <div class="views">
                                <i class="fas fa-eye"></i> <span id="views-count">0</span> vues
                            </div>
                        </div>
                    </div>
                </div>

                <div class="comments-container">
                    <h3 class="comments-title">Commentaires</h3>
                    <div class="comment-form">
                        <input type="text" class="comment-input" id="comment-input" placeholder="Ajouter un commentaire...">
                        <button class="btn btn-primary" id="add-comment-btn">
                            <i class="fas fa-paper-plane"></i> Publier
                        </button>
                    </div>
                    <div class="comment-list" id="comment-list">
                        <!-- Les commentaires seront ajoutés ici dynamiquement -->
                        <div class="message">
                            Aucun commentaire pour le moment. Soyez le premier à commenter !
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historique Section -->
            <div id="history-section" class="section">
                <h2><i class="fas fa-history"></i> Historique de visionnage</h2>
                <div class="history-container">
                    <div class="history-list" id="history-list">
                        <!-- L'historique sera ajouté ici dynamiquement -->
                        <div class="message">
                            Aucune vidéo visionnée pour le moment.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bibliothèque Section -->
            <div id="library-section" class="section">
                <h2><i class="fas fa-film"></i> Ma bibliothèque de vidéos</h2>
                <div class="admin-controls hidden" id="admin-controls">
                    <button class="btn btn-danger" id="delete-selected-btn">
                        <i class="fas fa-trash"></i> Supprimer les vidéos sélectionnées
                    </button>
                </div>
                <div class="library-container" id="library-container">
                    <!-- Les vidéos seront ajoutées ici dynamiquement -->
                    <div class="message">
                        Aucune vidéo importée. Allez dans la section "Importer" pour ajouter vos premières vidéos.
                    </div>
                </div>
            </div>

            <!-- Importer Section -->
            <div id="import-section" class="section">
                <h2><i class="fas fa-upload"></i> Importer une nouvelle vidéo</h2>
                <div class="import-container">
                    <form class="import-form" id="import-form">
                        <div class="form-group">
                            <label for="video-title">Titre de la vidéo</label>
                            <input type="text" id="video-title" class="form-control" placeholder="Entrez le titre de la vidéo" required>
                        </div>
                        <div class="form-group">
                            <label for="video-description">Description</label>
                            <textarea id="video-description" class="form-control" rows="3" placeholder="Entrez une description pour la vidéo"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="video-file">Fichier vidéo</label>
                            <input type="file" id="video-file" class="form-control" accept="video/*" required>
                            <small style="color: var(--text-secondary); margin-top: 5px;">
                                Formats supportés: MP4, WebM, OGG
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="video-thumbnail">Miniature (optionnel)</label>
                            <input type="file" id="video-thumbnail" class="form-control" accept="image/*">
                            <small style="color: var(--text-secondary); margin-top: 5px;">
                                Si aucune miniature n'est fournie, une image sera automatiquement extraite de la vidéo
                            </small>
                        </div>
                        <div class="admin-controls hidden" id="import-admin-controls">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-upload"></i> Importer la vidéo
                            </button>
                        </div>
                        <div class="message error hidden" id="import-error">
                            Seul l'administrateur peut importer des vidéos.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>ANIMEREF &copy; 2025 - Votre plateforme d'anime préférée</p>
        <p style="margin-top: 5px; font-size: 14px;">Version 1.0 - Développé avec <i class="fas fa-heart" style="color: #e53935;"></i></p>
    </footer>

    <script>
        // État de l'application
        const state = {
            videos: JSON.parse(localStorage.getItem('animeRefVideos')) || [],
            currentVideoIndex: null,
            isAdmin: false,
            history: JSON.parse(localStorage.getItem('animeRefHistory')) || [],
            comments: JSON.parse(localStorage.getItem('animeRefComments')) || {},
            likes: JSON.parse(localStorage.getItem('animeRefLikes')) || {}
        };

        // Éléments DOM principaux
        const videoPlayer = document.getElementById('video-player');
        const noVideoMessage = document.getElementById('no-video-message');
        const currentVideoTitle = document.getElementById('current-video-title');
        const viewsCount = document.getElementById('views-count');
        const libraryContainer = document.getElementById('library-container');
        const historyList = document.getElementById('history-list');
        const commentList = document.getElementById('comment-list');
        const commentInput = document.getElementById('comment-input');
        const addCommentBtn = document.getElementById('add-comment-btn');
        const likeBtn = document.getElementById('like-btn');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const deleteCurrentBtn = document.getElementById('delete-current-btn');
        const adminToggle = document.getElementById('admin-toggle');
        const adminControls = document.getElementById('admin-controls');
        const importAdminControls = document.getElementById('import-admin-controls');
        const importError = document.getElementById('import-error');
        const deleteSelectedBtn = document.getElementById('delete-selected-btn');
        const importForm = document.getElementById('import-form');
        const clearHistoryBtn = document.getElementById('clear-history');

        // Navigation
        const navLinks = document.querySelectorAll('nav ul li a');
        const sections = document.querySelectorAll('.section');
        const sidebarItems = document.querySelectorAll('.sidebar-item');

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier si l'utilisateur est admin (dans un cas réel, ce serait basé sur une authentification)
            // Pour cette démo, nous allons permettre à l'utilisateur de basculer en mode admin
            state.isAdmin = localStorage.getItem('animeRefIsAdmin') === 'true';
            updateAdminUI();
            
            // Charger les vidéos
            renderLibrary();
            renderHistory();
            
            // Si une vidéo est en cours de lecture, la restaurer
            if (state.currentVideoIndex !== null && state.videos[state.currentVideoIndex]) {
                loadVideo(state.currentVideoIndex);
            }
            
            // Ajouter des écouteurs d'événements
            setupEventListeners();
            
            // Afficher un message de bienvenue
            showMessage('Bienvenue sur ANIMEREF !', 'success');
        });

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.id.replace('nav-', '') + '-section';
                    
                    // Mettre à jour la navigation
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Afficher la section cible
                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById(targetId).classList.add('active');
                    
                    // Mettre à jour la sidebar
                    sidebarItems.forEach(item => item.classList.remove('active'));
                    if (targetId === 'home-section') {
                        document.querySelector('.sidebar-item[data-section="home"]').classList.add('active');
                    }
                });
            });
            
            // Sidebar
            document.querySelector('.sidebar-item[data-section="home"]').addEventListener('click', function() {
                // Mettre à jour la navigation
                navLinks.forEach(l => l.classList.remove('active'));
                document.getElementById('nav-home').classList.add('active');
                
                // Afficher la section accueil
                sections.forEach(section => section.classList.remove('active'));
                document.getElementById('home-section').classList.add('active');
                
                // Mettre à jour la sidebar
                sidebarItems.forEach(item => item.classList.remove('active'));
                this.classList.add('active');
            });
            
            // Bouton mode admin
            adminToggle.addEventListener('click', function() {
                state.isAdmin = !state.isAdmin;
                localStorage.setItem('animeRefIsAdmin', state.isAdmin);
                updateAdminUI();
                showMessage(state.isAdmin ? 'Mode admin activé' : 'Mode admin désactivé', 'success');
            });
            
            // Vider l'historique
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('Voulez-vous vraiment vider tout l\'historique ?')) {
                    state.history = [];
                    localStorage.setItem('animeRefHistory', JSON.stringify(state.history));
                    renderHistory();
                    showMessage('Historique vidé avec succès', 'success');
                }
            });
            
            // Boutons de contrôle vidéo
            playBtn.addEventListener('click', function() {
                if (videoPlayer.src) {
                    videoPlayer.play();
                }
            });
            
            pauseBtn.addEventListener('click', function() {
                if (videoPlayer.src) {
                    videoPlayer.pause();
                }
            });
            
            // Supprimer la vidéo en cours
            deleteCurrentBtn.addEventListener('click', function() {
                if (state.currentVideoIndex !== null) {
                    deleteVideo(state.currentVideoIndex);
                }
            });
            
            // Like
            likeBtn.addEventListener('click', function() {
                if (state.currentVideoIndex === null) return;
                
                const videoId = state.videos[state.currentVideoIndex].id;
                state.likes[videoId] = !state.likes[videoId];
                localStorage.setItem('animeRefLikes', JSON.stringify(state.likes));
                updateLikeButton();
            });
            
            // Ajouter un commentaire
            addCommentBtn.addEventListener('click', addComment);
            commentInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    addComment();
                }
            });
            
            // Importer une vidéo
            importForm.addEventListener('submit', function(e) {
                e.preventDefault();
                importVideo();
            });
            
            // Supprimer les vidéos sélectionnées
            deleteSelectedBtn.addEventListener('click', deleteSelectedVideos);
            
            // Quand la vidéo est lue, incrémenter les vues
            videoPlayer.addEventListener('play', function() {
                if (state.currentVideoIndex !== null) {
                    const videoId = state.videos[state.currentVideoIndex].id;
                    
                    // Incrémenter les vues
                    if (!state.videos[state.currentVideoIndex].views) {
                        state.videos[state.currentVideoIndex].views = 1;
                    } else {
                        state.videos[state.currentVideoIndex].views++;
                    }
                    
                    // Ajouter à l'historique
                    const historyEntry = {
                        videoId: videoId,
                        title: state.videos[state.currentVideoIndex].title,
                        thumbnail: state.videos[state.currentVideoIndex].thumbnail,
                        date: new Date().toLocaleString('fr-FR')
                    };
                    
                    // Vérifier si la vidéo n'est pas déjà dans l'historique (pour éviter les doublons)
                    const existingIndex = state.history.findIndex(item => item.videoId === videoId);
                    if (existingIndex !== -1) {
                        state.history.splice(existingIndex, 1);
                    }
                    
                    state.history.unshift(historyEntry);
                    
                    // Limiter l'historique à 50 entrées
                    if (state.history.length > 50) {
                        state.history.pop();
                    }
                    
                    // Sauvegarder
                    localStorage.setItem('animeRefVideos', JSON.stringify(state.videos));
                    localStorage.setItem('animeRefHistory', JSON.stringify(state.history));
                    
                    // Mettre à jour l'UI
                    viewsCount.textContent = state.videos[state.currentVideoIndex].views;
                    renderHistory();
                    renderLibrary();
                }
            });
            
            // Quand la vidéo se termine
            videoPlayer.addEventListener('ended', function() {
                // Jouer automatiquement la vidéo suivante si disponible
                if (state.currentVideoIndex !== null && state.currentVideoIndex < state.videos.length - 1) {
                    loadVideo(state.currentVideoIndex + 1);
                }
            });
        }

        // Importer une vidéo
        function importVideo() {
            if (!state.isAdmin) {
                importError.classList.remove('hidden');
                return;
            }
            
            importError.classList.add('hidden');
            
            const title = document.getElementById('video-title').value;
            const description = document.getElementById('video-description').value;
            const videoFile = document.getElementById('video-file').files[0];
            const thumbnailFile = document.getElementById('video-thumbnail').files[0];
            
            if (!videoFile) {
                showMessage('Veuillez sélectionner un fichier vidéo', 'error');
                return;
            }
            
            // Créer un URL pour la vidéo
            const videoURL = URL.createObjectURL(videoFile);
            
            // Générer un identifiant unique
            const videoId = 'video_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Créer un objet vidéo
            const video = {
                id: videoId,
                title: title || 'Vidéo sans titre',
                description: description,
                url: videoURL,
                thumbnail: null,
                views: 0,
                date: new Date().toLocaleString('fr-FR')
            };
            
            // Gérer la miniature
            if (thumbnailFile) {
                // Si l'utilisateur a fourni une miniature
                const thumbnailURL = URL.createObjectURL(thumbnailFile);
                video.thumbnail = thumbnailURL;
            } else {
                // Sinon, extraire une image de la vidéo
                extractThumbnailFromVideo(videoFile, videoId).then(thumbnailURL => {
                    video.thumbnail = thumbnailURL;
                    // Sauvegarder la vidéo avec la miniature
                    saveVideo(video);
                }).catch(error => {
                    console.error('Erreur lors de l\'extraction de la miniature:', error);
                    // Utiliser une image par défaut
                    video.thumbnail = 'https://via.placeholder.com/300x170/23252b/f47521?text=ANIMEREF';
                    saveVideo(video);
                });
                return;
            }
            
            // Sauvegarder la vidéo
            saveVideo(video);
        }

        // Extraire une miniature d'une vidéo
        function extractThumbnailFromVideo(videoFile, videoId) {
            return new Promise((resolve, reject) => {
                const videoElement = document.createElement('video');
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                videoElement.preload = 'metadata';
                videoElement.muted = true;
                videoElement.playsInline = true;
                
                videoElement.onloadedmetadata = function() {
                    // Définir la position à 25% de la durée pour une bonne miniature
                    videoElement.currentTime = Math.min(videoElement.duration * 0.25, 10);
                };
                
                videoElement.onseeked = function() {
                    // Dessiner l'image sur le canvas
                    canvas.width = videoElement.videoWidth;
                    canvas.height = videoElement.videoHeight;
                    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                    
                    // Convertir en URL de données
                    const thumbnailURL = canvas.toDataURL('image/jpeg', 0.8);
                    resolve(thumbnailURL);
                };
                
                videoElement.onerror = function() {
                    reject(new Error('Erreur lors du chargement de la vidéo'));
                };
                
                // Charger la vidéo
                videoElement.src = URL.createObjectURL(videoFile);
            });
        }

        // Sauvegarder une vidéo
        function saveVideo(video) {
            // Ajouter la vidéo à la liste
            state.videos.unshift(video);
            
            // Sauvegarder dans le localStorage
            localStorage.setItem('animeRefVideos', JSON.stringify(state.videos));
            
            // Réinitialiser le formulaire
            document.getElementById('video-title').value = '';
            document.getElementById('video-description').value = '';
            document.getElementById('video-file').value = '';
            document.getElementById('video-thumbnail').value = '';
            
            // Mettre à jour l'interface
            renderLibrary();
            showMessage('Vidéo importée avec succès !', 'success');
            
            // Si c'est la première vidéo, la charger automatiquement
            if (state.videos.length === 1) {
                loadVideo(0);
            }
        }

        // Charger une vidéo
        function loadVideo(index) {
            if (index < 0 || index >= state.videos.length) return;
            
            const video = state.videos[index];
            state.currentVideoIndex = index;
            
            // Mettre à jour le lecteur vidéo
            videoPlayer.src = video.url;
            videoPlayer.classList.remove('hidden');
            noVideoMessage.classList.add('hidden');
            currentVideoTitle.textContent = video.title;
            viewsCount.textContent = video.views || 0;
            
            // Afficher le bouton de suppression si admin
            if (state.isAdmin) {
                deleteCurrentBtn.classList.remove('hidden');
            } else {
                deleteCurrentBtn.classList.add('hidden');
            }
            
            // Mettre à jour le bouton like
            updateLikeButton();
            
            // Charger les commentaires
            renderComments();
            
            // Jouer automatiquement
            videoPlayer.play().catch(e => {
                console.log('Lecture automatique bloquée par le navigateur');
            });
        }

        // Supprimer une vidéo
        function deleteVideo(index) {
            if (!state.isAdmin) {
                showMessage('Seul l\'administrateur peut supprimer des vidéos', 'error');
                return;
            }
            
            if (index < 0 || index >= state.videos.length) return;
            
            const video = state.videos[index];
            
            // Libérer les URLs
            URL.revokeObjectURL(video.url);
            if (video.thumbnail && video.thumbnail.startsWith('blob:')) {
                URL.revokeObjectURL(video.thumbnail);
            }
            
            // Supprimer la vidéo
            state.videos.splice(index, 1);
            
            // Sauvegarder
            localStorage.setItem('animeRefVideos', JSON.stringify(state.videos));
            
            // Mettre à jour l'interface
            renderLibrary();
            
            // Si la vidéo supprimée était celle en cours
            if (state.currentVideoIndex === index) {
                if (state.videos.length > 0) {
                    // Charger la première vidéo disponible
                    loadVideo(0);
                } else {
                    // Réinitialiser le lecteur
                    videoPlayer.src = '';
                    videoPlayer.classList.add('hidden');
                    noVideoMessage.classList.remove('hidden');
                    currentVideoTitle.textContent = 'Aucune vidéo sélectionnée';
                    viewsCount.textContent = '0';
                    deleteCurrentBtn.classList.add('hidden');
                    state.currentVideoIndex = null;
                    
                    // Effacer les commentaires
                    commentList.innerHTML = '<div class="message">Aucun commentaire pour le moment. Soyez le premier à commenter !</div>';
                }
            } else if (state.currentVideoIndex > index) {
                // Ajuster l'index de la vidéo en cours
                state.currentVideoIndex--;
            }
            
            showMessage('Vidéo supprimée avec succès', 'success');
        }

        // Supprimer les vidéos sélectionnées
        function deleteSelectedVideos() {
            if (!state.isAdmin) {
                showMessage('Seul l\'administrateur peut supprimer des vidéos', 'error');
                return;
            }
            
            const checkboxes = document.querySelectorAll('.video-checkbox:checked');
            if (checkboxes.length === 0) {
                showMessage('Aucune vidéo sélectionnée', 'error');
                return;
            }
            
            if (!confirm(`Voulez-vous vraiment supprimer ${checkboxes.length} vidéo(s) ?`)) {
                return;
            }
            
            // Récupérer les indices des vidéos à supprimer (du plus grand au plus petit pour éviter les problèmes d'indices)
            const indices = Array.from(checkboxes)
                .map(checkbox => parseInt(checkbox.dataset.index))
                .sort((a, b) => b - a); // Tri décroissant
            
            // Supprimer les vidéos
            indices.forEach(index => {
                const video = state.videos[index];
                
                // Libérer les URLs
                URL.revokeObjectURL(video.url);
                if (video.thumbnail && video.thumbnail.startsWith('blob:')) {
                    URL.revokeObjectURL(video.thumbnail);
                }
                
                state.videos.splice(index, 1);
            });
            
            // Sauvegarder
            localStorage.setItem('animeRefVideos', JSON.stringify(state.videos));
            
            // Mettre à jour l'interface
            renderLibrary();
            
            // Ajuster l'index de la vidéo en cours si nécessaire
            if (state.currentVideoIndex !== null) {
                let newIndex = state.currentVideoIndex;
                
                // Compter combien de vidéos avant l'index actuel ont été supprimées
                const deletedBefore = indices.filter(index => index < state.currentVideoIndex).length;
                newIndex -= deletedBefore;
                
                // Si la vidéo en cours a été supprimée
                if (indices.includes(state.currentVideoIndex)) {
                    if (state.videos.length > 0) {
                        loadVideo(Math.min(newIndex, state.videos.length - 1));
                    } else {
                        // Réinitialiser le lecteur
                        videoPlayer.src = '';
                        videoPlayer.classList.add('hidden');
                        noVideoMessage.classList.remove('hidden');
                        currentVideoTitle.textContent = 'Aucune vidéo sélectionnée';
                        viewsCount.textContent = '0';
                        deleteCurrentBtn.classList.add('hidden');
                        state.currentVideoIndex = null;
                        
                        // Effacer les commentaires
                        commentList.innerHTML = '<div class="message">Aucun commentaire pour le moment. Soyez le premier à commenter !</div>';
                    }
                } else if (newIndex !== state.currentVideoIndex) {
                    state.currentVideoIndex = newIndex;
                }
            }
            
            showMessage(`${indices.length} vidéo(s) supprimée(s) avec succès`, 'success');
        }

        // Ajouter un commentaire
        function addComment() {
            const text = commentInput.value.trim();
            if (!text) return;
            
            if (state.currentVideoIndex === null) {
                showMessage('Veuillez d\'abord sélectionner une vidéo', 'error');
                return;
            }
            
            const videoId = state.videos[state.currentVideoIndex].id;
            
            // Initialiser les commentaires pour cette vidéo si nécessaire
            if (!state.comments[videoId]) {
                state.comments[videoId] = [];
            }
            
            // Ajouter le commentaire
            const comment = {
                id: 'comment_' + Date.now(),
                author: 'Utilisateur',
                text: text,
                date: new Date().toLocaleString('fr-FR'),
                canDelete: state.isAdmin // Seul l'admin peut supprimer
            };
            
            state.comments[videoId].unshift(comment);
            localStorage.setItem('animeRefComments', JSON.stringify(state.comments));
            
            // Réinitialiser le champ de saisie
            commentInput.value = '';
            
            // Mettre à jour l'affichage
            renderComments();
        }

        // Supprimer un commentaire
        function deleteComment(videoId, commentId) {
            if (!state.isAdmin) return;
            
            if (state.comments[videoId]) {
                state.comments[videoId] = state.comments[videoId].filter(c => c.id !== commentId);
                localStorage.setItem('animeRefComments', JSON.stringify(state.comments));
                renderComments();
            }
        }

        // Mettre à jour le bouton like
        function updateLikeButton() {
            if (state.currentVideoIndex === null) return;
            
            const videoId = state.videos[state.currentVideoIndex].id;
            const isLiked = state.likes[videoId] || false;
            
            likeBtn.innerHTML = isLiked ? 
                '<i class="fas fa-heart"></i>' : 
                '<i class="far fa-heart"></i>';
            likeBtn.classList.toggle('liked', isLiked);
        }

        // Afficher la bibliothèque
        function renderLibrary() {
            if (state.videos.length === 0) {
                libraryContainer.innerHTML = '<div class="message">Aucune vidéo importée. Allez dans la section "Importer" pour ajouter vos premières vidéos.</div>';
                return;
            }
            
            libraryContainer.innerHTML = '';
            
            state.videos.forEach((video, index) => {
                const videoCard = document.createElement('div');
                videoCard.className = 'video-card';
                videoCard.dataset.index = index;
                
                videoCard.innerHTML = `
                    ${state.isAdmin ? `<div class="admin-checkbox"><input type="checkbox" class="video-checkbox" data-index="${index}" style="position: absolute; top: 10px; left: 10px; z-index: 2;"></div>` : ''}
                    <img src="${video.thumbnail || 'https://via.placeholder.com/300x170/23252b/f47521?text=ANIMEREF'}" alt="${video.title}" class="video-thumbnail">
                    <div class="video-card-info">
                        <div class="video-card-title">${video.title}</div>
                        <div class="video-card-details">
                            <span>${video.views || 0} vues</span>
                            <span>${video.date}</span>
                        </div>
                        ${state.isAdmin ? `<button class="delete-video-btn" data-index="${index}"><i class="fas fa-trash"></i></button>` : ''}
                    </div>
                `;
                
                // Écouteurs d'événements pour la carte vidéo
                const thumbnail = videoCard.querySelector('.video-thumbnail');
                const title = videoCard.querySelector('.video-card-title');
                const deleteBtn = videoCard.querySelector('.delete-video-btn');
                
                thumbnail.addEventListener('click', () => loadVideo(index));
                title.addEventListener('click', () => loadVideo(index));
                
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteVideo(index);
                    });
                }
                
                libraryContainer.appendChild(videoCard);
            });
        }

        // Afficher l'historique
        function renderHistory() {
            if (state.history.length === 0) {
                historyList.innerHTML = '<div class="message">Aucune vidéo visionnée pour le moment.</div>';
                return;
            }
            
            historyList.innerHTML = '';
            
            state.history.forEach(entry => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                historyItem.innerHTML = `
                    <img src="${entry.thumbnail || 'https://via.placeholder.com/120x70/23252b/f47521?text=ANIMEREF'}" alt="${entry.title}" class="history-thumbnail">
                    <div class="history-info">
                        <div class="history-title">${entry.title}</div>
                        <div class="history-date">Visionné le ${entry.date}</div>
                    </div>
                `;
                
                // Trouver l'index de la vidéo correspondante
                const videoIndex = state.videos.findIndex(v => v.id === entry.videoId);
                
                // Si la vidéo existe encore, permettre de la lire
                if (videoIndex !== -1) {
                    historyItem.style.cursor = 'pointer';
                    historyItem.addEventListener('click', () => loadVideo(videoIndex));
                    
                    // Aller à la section accueil
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.getElementById('nav-home').classList.add('active');
                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById('home-section').classList.add('active');
                    sidebarItems.forEach(item => item.classList.remove('active'));
                    document.querySelector('.sidebar-item[data-section="home"]').classList.add('active');
                } else {
                    historyItem.style.opacity = '0.7';
                }
                
                historyList.appendChild(historyItem);
            });
        }

        // Afficher les commentaires
        function renderComments() {
            if (state.currentVideoIndex === null) {
                commentList.innerHTML = '<div class="message">Veuillez sélectionner une vidéo pour voir les commentaires.</div>';
                return;
            }
            
            const videoId = state.videos[state.currentVideoIndex].id;
            const comments = state.comments[videoId] || [];
            
            if (comments.length === 0) {
                commentList.innerHTML = '<div class="message">Aucun commentaire pour le moment. Soyez le premier à commenter !</div>';
                return;
            }
            
            commentList.innerHTML = '';
            
            comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.dataset.id = comment.id;
                
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-date">${comment.date}</div>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                    ${state.isAdmin ? `
                    <div class="comment-actions">
                        <button class="comment-action delete-comment-btn">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </div>
                    ` : ''}
                `;
                
                // Écouteur d'événement pour supprimer le commentaire (admin seulement)
                const deleteBtn = commentElement.querySelector('.delete-comment-btn');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', () => {
                        deleteComment(videoId, comment.id);
                    });
                }
                
                commentList.appendChild(commentElement);
            });
        }

        // Mettre à jour l'interface admin
        function updateAdminUI() {
            if (state.isAdmin) {
                adminToggle.innerHTML = '<i class="fas fa-crown"></i> Mode Admin (Activé)';
                adminToggle.style.color = 'var(--primary-color)';
                adminControls.classList.remove('hidden');
                importAdminControls.classList.remove('hidden');
                importError.classList.add('hidden');
                
                // Afficher le bouton de suppression sur la vidéo en cours
                if (state.currentVideoIndex !== null) {
                    deleteCurrentBtn.classList.remove('hidden');
                }
            } else {
                adminToggle.innerHTML = '<i class="fas fa-crown"></i> Mode Admin';
                adminToggle.style.color = '';
                adminControls.classList.add('hidden');
                importAdminControls.classList.add('hidden');
                deleteCurrentBtn.classList.add('hidden');
            }
            
            // Re-render pour afficher/masquer les contrôles admin
            renderLibrary();
            renderComments();
        }

        // Afficher un message temporaire
        function showMessage(text, type) {
            // Supprimer les messages existants
            const existingMessages = document.querySelectorAll('.message.temporary');
            existingMessages.forEach(msg => msg.remove());
            
            // Créer un nouveau message
            const message = document.createElement('div');
            message.className = `message ${type} temporary`;
            message.textContent = text;
            message.style.position = 'fixed';
            message.style.top = '80px';
            message.style.right = '20px';
            message.style.zIndex = '1000';
            message.style.maxWidth = '300px';
            message.style.boxShadow = '0 4px 12px rgba(0,0,0,0.3)';
            
            document.body.appendChild(message);
            
            // Supprimer le message après 3 secondes
            setTimeout(() => {
                if (message.parentNode) {
                    message.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
